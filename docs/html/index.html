<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lane and Object Detection: Lane and Object Detection</title>
<link rel="icon" href="LaneAndObjectDetection.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.title = "Toggle light/dark mode"
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="LaneAndObjectDetection.ico"/></td>
  <td id="projectalign">
   <div id="projectname">Lane and Object Detection
   </div>
   <div id="projectbrief">Using OpenCV and YOLOv7</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Lane and Object Detection </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p>Lane and object detection for use in autonomous vehicles using OpenCV and YOLOv7.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Getting Started</h1>
<p>Binaries can be found in <a href="https://github.com/J-Afzal/Lane-and-Object-Detection/releases">Releases</a> or, if preferred, CMake can be used to build the project from source either through the PowerShell helper module:</p>
<dl class="section important"><dt>Important</dt><dd>Make sure to download the <a href="https://github.com/AlexeyAB/darknet/releases/download/yolov4/yolov7.weights"><span class="tt">yolov7.weights</span></a> file into the <span class="tt">./resources/yolo/</span> folder and included in the repository is a <span class="tt">benchmark.mp4</span> file which can be used to run the program against.</dd></dl>
<div class="fragment"><div class="line">Import-Module ./modules/Build.psd1;</div>
<div class="line"> </div>
<div class="line">Build-CppCodeUsingCMake -Platform windows-latest -BuildType Release -BuildDirectory build -Parallel 8 -Verbose;</div>
<div class="line"> </div>
<div class="line">./build/lane-and-object-detection/lane-and-object-detection -i ./tests/performance_tests/benchmark.mp4 -y ./resources/yolo/</div>
</div><!-- fragment --><p>or manually:</p>
<div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/J-Afzal/Lane-and-Object-Detection.git</div>
<div class="line">cd Lane-and-Object-Detection</div>
<div class="line"> </div>
<div class="line"># Build OpenCV</div>
<div class="line">cd ./submodules/opencv/</div>
<div class="line">cmake -S . -B ./build -D &quot;CMAKE_BUILD_TYPE=Release&quot; -D &quot;BUILD_opencv_world=ON&quot;</div>
<div class="line">cmake --build ./build --config Release --parallel 8</div>
<div class="line">cd ../..</div>
<div class="line"> </div>
<div class="line"># Build Lane and Object Detection</div>
<div class="line">cmake -S . -B ./build -D &quot;CMAKE_BUILD_TYPE=Release&quot;</div>
<div class="line">cmake --build ./build --config Release --parallel 8</div>
<div class="line"> </div>
<div class="line"># The `yolov7.weights` file could not be uploaded due to GitHub&#39;s 100 MB upload limit, but is included as a download step for</div>
<div class="line"># both the PowerShell helper module and these manual instructions</div>
<div class="line">curl -L -o .\resources\yolo\yolov7.weights &quot;https://github.com/AlexeyAB/darknet/releases/download/yolov4/yolov7.weights&quot;</div>
<div class="line"> </div>
<div class="line">./build/lane-and-object-detection/lane-and-object-detection -i ./tests/performance_tests/benchmark.mp4 -y ./resources/yolo/</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>If on Windows make sure to run the above within a Visual Studio Developer Command Prompt otherwise you may see errors around <span class="tt">cl.exe</span> not being found. Also, if on Windows make sure to add -G "NMake Makefiles" otherwise the required dlls may not be in the expected locations for the above instructions.</dd></dl>
<p>Here are the full list of options for Lane and Object Detection:</p>
<div class="fragment"><div class="line">Usage: lane-and-object-detection --input ... --yolo-folder-path ... [optional]</div>
<div class="line"> </div>
<div class="line">OPTIONS:</div>
<div class="line"> </div>
<div class="line">Generic Options:</div>
<div class="line"> </div>
<div class="line">  -h --help                       Display available options.</div>
<div class="line"> </div>
<div class="line">Required Options:</div>
<div class="line"> </div>
<div class="line">  -i --input                      File path or camera ID</div>
<div class="line">  -y --yolo-folder-path           Path to the yolo folder</div>
<div class="line"> </div>
<div class="line">Optional options:</div>
<div class="line"> </div>
<div class="line">  -o --object-detector-type       One of: none, standard or tiny. (default = none)</div>
<div class="line">  -b --object-detector-backend    One of: cpu, gpu or cuda (default = cpu)</div>
<div class="line">  -s --object-detector-blob-size  One of: 208, 320, 416, 512 or 608 (default = 208)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>CUDA is supported by OpenCV but would require a CUDA enabled OpenCV installation which both the PowerShell helper module and the manual instructions don't do.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Documentation</h1>
<p>Checkout the <a href="https://J-Afzal.github.io/Lane-and-Object-Detection">documentation page</a> built using Doxygen and hosted using Github pages.</p>
<p><img src="./resources/screenshots/DocumentationHomepage.png" alt="Documentation Homepage" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
General Information</h1>
<p>This program uses YOLOv7 for object detection and OpenCV for lane detection. OpenCV is also used for handling IO such as reading and writing video file as well as display the output to a window.</p>
<p>The object detection is able to detect most road-related objects such as cars, buses, trucks, cyclists, pedestrians, traffic lights, etc. The accuracy and speed of detection is dependent upon the available GPU compute. For higher quality detection select a higher blob size. For more performant detection select a lower blob size, and/or select the tiny detector type and/or GPU backend. For maximum performance the CUDA backend should be used, however, this requires building OpenCV with CUDA which is not supported with this projects built-in installation script.</p>
<p>The lane detection code is custom made for this program. The one sentence summary would be that it: creates an ROI frame to isolate the road markings immediately in front of the car, runs the Canny algorithm to retrieve the edges, runs the Hough transform to get the straight lines, de-noises and categorises the straight lines to determine the location of the current lane.</p>
<p>The program has two modes:</p>
<ol type="1">
<li><p class="startli"><span class="tt">Normal Mode</span> which only displays the current driving state and the detected left and right lane line types:</p>
<p class="startli"><img src="./resources/screenshots/NormalMode.png" alt="Normal Mode" class="inline"/></p>
</li>
</ol>
<ol type="1">
<li><p class="startli"><span class="tt">Debug Mode</span> which additionally displays the current FPS, average FPS and the ROI, Canny and Hough intermediary frames.</p>
<p class="startli"><img src="./resources/screenshots/DebugMode.png" alt="Debug Mode" class="inline"/></p>
</li>
</ol>
<p>Both modes support recording the output of the main frame.</p>
<p><img src="./resources/screenshots/RecordingMode.png" alt="Recording Mode" class="inline"/></p>
<p>Pressing <span class="tt">q</span> will quit the program.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Performance Tests</h2>
<p>The project includes performance testing and graphing capability to test the FPS across the blob sizes and yolo types.</p>
<p>Build the C++ code as mentioned in <a href="./#getting-started">Getting Started</a> and run the performance tests (replace <span class="tt">&lt;&lt;platform name&gt;&gt;</span>) which will output their results into a SQLite database file:</p>
<div class="fragment"><div class="line">./build/lane-and-object-detection-performance-tests `</div>
<div class="line">    -p &lt;&lt;platform name&gt;&gt; `</div>
<div class="line">    -d ./tests/output/sqlite-&lt;&lt;platform name&gt;&gt;.db `</div>
<div class="line">    -i ./tests/performance_tests/benchmark.mp4 `</div>
<div class="line">    -y ./resources/yolo/ `</div>
<div class="line">    -r 1;</div>
</div><!-- fragment --><p>Install the python dependencies:</p>
<div class="fragment"><div class="line">python -m venv .venv/</div>
<div class="line">.\.venv\Scripts\activate</div>
<div class="line">pip install -r ./requirements.txt</div>
</div><!-- fragment --><p>Run the performance graph generation (single platform):</p>
<div class="fragment"><div class="line">python -m ./tests/main.py `</div>
<div class="line">    -d ./tests/output/sqlite-&lt;&lt;platform name&gt;&gt;.db  `</div>
<div class="line">    -o ./tests/output/</div>
</div><!-- fragment --><p>or for multiple platforms (this will generate individual platform and multi-platform graphs):</p>
<div class="fragment"><div class="line">python -m ./tests/main.py `</div>
<div class="line">    -d ./tests/output/sqlite-&lt;&lt;platform name&gt;&gt;.db,./tests/output/sqlite-&lt;&lt;platform name&gt;&gt;.db,./tests/output/sqlite-&lt;&lt;platform name&gt;&gt;.db `</div>
<div class="line">    -o ./tests/output/</div>
</div><!-- fragment --><p>The following are some example graph outputs based on the following invocation:</p>
<div class="fragment"><div class="line">python -m ./tests/main.py -d ./tests/output/ubuntu_20.04.db,./tests/output/windows_10.db -o ./tests/output/</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Ubuntu 20.04</h3>
<p><img src="./tests/output/ubuntu_20_04_frame_time_graph.png" alt="Ubuntu 20.04 Frame Time Graph" class="inline"/></p>
<p><img src="./tests/output/ubuntu_20_04_fps_graph.png" alt="Ubuntu 20.04 FPS Graph" class="inline"/></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Windows 10</h3>
<p><img src="./tests/output/windows_10_frame_time_graph.png" alt="Windows 10 Frame Time Graph" class="inline"/></p>
<p><img src="./tests/output/windows_10_fps_graph.png" alt="Windows 10 FPS Graph" class="inline"/></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
All Platforms</h3>
<p><img src="./tests/output/all_platforms_frame_time_graph.png" alt="All Platforms Frame Time Graph" class="inline"/></p>
<p><img src="./tests/output/all_platforms_fps_graph.png" alt="All Platforms FPS Graph" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
CI / CD</h1>
<p><a href="https://github.com/J-Afzal/Lane-and-Object-Detection/actions/workflows/ContinuousIntegration.yml"><img src="https://github.com/J-Afzal/Lane-and-Object-Detection/actions/workflows/ContinuousIntegration.yml/badge.svg" alt="Continuous Integration" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/J-Afzal/Lane-and-Object-Detection/actions/workflows/ContinuousDeployment.yml"><img src="https://github.com/J-Afzal/Lane-and-Object-Detection/actions/workflows/ContinuousDeployment.yml/badge.svg" alt="Continuous Deployment" style="pointer-events: none;" class="inline"/></a></p>
<p>The continuous integration workflow runs against all commits on pull requests, builds the code, runs unit tests and performs linting checks.</p>
<p>The continuous deployment workflow runs against all commits to main, builds the code and deploys the executables as a release.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Development Setup</h1>
<p>For development a few extra tools are needed to check for linting issues locally which include the <a href="https://github.com/J-Afzal/Linters">Linters</a> and <a href="https://github.com/opencv/opencv">OpenCV</a> submodules:</p>
<div class="fragment"><div class="line">git clone --recurse-submodules https://github.com/J-Afzal/Lane-and-Object-Detection.git</div>
</div><!-- fragment --><p>The development dependencies are:</p>
<ul>
<li>Git</li>
<li>PowerShell version &gt;= 5</li>
<li>npm dependencies via <span class="tt">npm install</span></li>
<li>clang-tidy &gt;= 19 and clang-format &gt;= 19</li>
<li>CMake &gt;= 3.20</li>
<li>Ninja &gt;= 1.12.1</li>
</ul>
<p>All linting helper functions can be found in the <a href="https://github.com/J-Afzal/Linters">Linters</a> submodule.</p>
<p>Any generator can be used to build the project but to prior to running <span class="tt">clang-tidy</span>/<span class="tt">clang-format</span> CMake must be configured using a generator that creates a <span class="tt">compile_commands.json</span> file in the build directory (e.g. <span class="tt">-G "Ninja"</span>, <span class="tt">-G "NMake Makefiles"</span>, etc)</p>
<p>On windows, clang-tidy and clang-format can be installed using the <span class="tt">LLVM-x.x.x-win64.exe</span> binary from the <a href="https://github.com/llvm/llvm-project/releases">LLVM release page</a> or from <a href="https://community.chocolatey.org/packages/llvm">chocolatey</a> using <span class="tt">choco install llvm -y</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
IDE</h2>
<p>On Windows, Visual Studio 2022 can be used by opening the folder as a CMake project and Visual Studio Code can be used by opening the folder through the <span class="tt">Developer PowerShell for VS</span> (otherwise you may see errors around cl.exe not being found). </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for Lane and Object Detection by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
